# JSLT Studio

JSLT Studio — веб-инструмент для интерактивного тестирования преобразований JSON по правилам JSLT. Интерфейс предоставляет три панели (входные данные, схема JSLT и итоговый JSON), так что вы можете проверять логику без самостоятельной сборки и вызова движка Schibsted.

## Основные возможности
- Встроенная подсветка состояния: индикатор выполнения и время работы движка после каждого запуска.
- Автоматическая проверка синтаксиса входного JSON и мягкое форматирование для обеих панелей ввода (`Prettify`).
- Обработка ошибок от движка JSLT и отображение ответа сервера в панели результата.
- Готовый пример входных данных и схемы из `constants.ts`, чтобы сразу увидеть работу движка.

## Архитектура
- **Клиент** — React 19 + Vite (`App.tsx`, `components/CodeEditor.tsx`).
- **Сервер** — Express (`server/index.js`), который принимает запросы на `/api/transform`, вызывает Java CLI `com.schibsted.spt.data.jslt.cli.JSLT` и возвращает результат в формате JSON.
- **Сборка** — Vite генерирует статику в `dist/`, сервер раздаёт её и проксирует вызовы движка.

## Требования
- Node.js 18+ (в контейнере используется Node 22).
- Java 11+ и jar-файлы JSLT (скачиваются автоматически в Docker-образе, для локального запуска нужно подготовить вручную).

## Локальный запуск
1. Установите зависимости: `npm ci`.
2. Скачайте jar-файлы JSLT и Jackson в каталог `java-lib` или задайте путь через переменные:
   - `JSLT_JAR_DIR=/path/to/jars` (каталог с jar-файлами).
   - `JSLT_CLASSPATH=/path/to/jars/*` (если хотите переопределить classpath).
   Пример набора артефактов: `jslt-0.1.14.jar`, `jackson-databind-2.13.4.2.jar`, `jackson-annotations-2.13.4.jar`, `jackson-core-2.13.4.jar`.
3. Соберите фронтенд: `npm run build` (создаёт `dist/`).
4. Запустите сервер: `npm run start` и откройте `http://localhost:8080`. Эндпоинт трансформации доступен по `/api/transform`.

### Режим разработки
- Запустите сервер (`npm run start`) в одном терминале, чтобы был доступен Java-движок.
- В другом терминале запустите Vite (`npm run dev`). Фронтенд поднимется на `http://localhost:3000`, API — на `http://localhost:8080`. При необходимости укажите URL для фронтенда через `VITE_JSLT_ENDPOINT` (по умолчанию `/api/transform`).

## Docker
- Сборка: `docker build -t jslt-studio .` — образ скачает Java и нужные jar-файлы в `/opt/jslt` автоматически.
- Запуск: `docker run -p 8080:8080 jslt-studio`.
- Docker Compose использует тот же образ и по умолчанию пробрасывает порт `127.0.0.1:8083 -> 8080` (см. `docker-compose.yml`).

## Структура проекта
- `App.tsx` — основное приложение с тремя редакторами, форматированием и отображением статуса выполнения.
- `components/CodeEditor.tsx` — лёгкий редактор на базе `<textarea>` с кнопкой `Prettify` и индикацией ошибок.
- `services/jsltService.ts` — HTTP-клиент для вызова `/api/transform`, управляет проверкой входного JSON и форматированием ответа.
- `server/index.js` — HTTP-обёртка над Java CLI, умеет работать с пользовательским `JSLT_JAR_DIR`/`JSLT_CLASSPATH` и корректно отдаёт ошибки движка.
